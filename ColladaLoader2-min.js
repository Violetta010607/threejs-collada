// Generated by CoffeeScript 1.3.3
var ColladaAsset,ColladaColorOrTexture,ColladaEffect,ColladaEffectSampler,ColladaEffectSurface,ColladaEffectTechnique,ColladaFile,ColladaFxLink,ColladaGeometry,ColladaImage,ColladaInput,ColladaLoader2,ColladaMaterial,ColladaSidLink,ColladaSource,ColladaUrlLink;ColladaUrlLink=function(){function e(e,t){this.url=e.replace(/^#/,""),this.object=null,this.type=t}return e.prototype.resolve=function(e,t){return this.object=e.dae.ids[this.url],this.object==null?(t("Could not resolve URL #"+this.url,ColladaLoader2.messageError),!1):this.type!=null&&!this.object instanceof this.type?(this.object=null,t("URL #"+this.url+" is not linked to a "+type,ColladaLoader2.messageError),!1):!0},e}(),ColladaFxLink=function(){function e(e,t,n){this.url=e,this.scope=t,this.object=null,this.type=n}return e.prototype.resolve=function(e,t){var n;n=this.scope,this.object=n.sids[this.url];while(this.object==null&&n!=null)n=n.parentFxScope,this.object=n.sids[this.url];return this.object==null?(t("Could not resolve FX parameter #"+this.url,ColladaLoader2.messageError),!1):this.type!=null&&!this.object instanceof this.type?(this.object=null,t("FX parameter #"+this.url+" is not linked to a "+type,ColladaLoader2.messageError),!1):!0},e}(),ColladaSidLink=function(){function e(e,t,n){var r,i,s,o,u,a,f,l;this.url=t,this.object=null,this.type=n,this.id=null,this.sids=[],this.member=null,this.indices=null,this.dotSyntax=!1,this.arrSyntax=!1,a=t.split("/"),this.id=a.shift(),this.id==="."&&(this.id=e);while(a.length>1)this.sids.push(a.shift());if(a.length>0){u=a[0],s=u.indexOf(".")>=0,i=astSid.indexOf("(")>=0;if(s)a=sid.split("."),this.sids.push(a.shift()),this.member=a.shift(),this.dotSyntax=!0;else if(i){r=u.split("("),this.sids.push(r.shift()),this.indices=[];for(f=0,l=r.length;f<l;f++)o=r[f],this.indices.push(parseInt(o.replace(/\)/,"")));this.arrSyntax=!0}else this.sids.push(u)}}return e.prototype.resolve=function(e,t){var n,r,i,s;this.object=e.dae.ids[this.id];if(this.object==null)return t("Could not resolve SID #"+this.url+", missing base ID "+this.id,ColladaLoader2.messageError),!1;s=this.sids;for(r=0,i=s.length;r<i;r++){n=s[r],this.object=this.object.sids[n];if(this.object==null)return t("Could not resolve SID #"+this.url+", missing SID part "+n,ColladaLoader2.messageError),!1}return!0},e}(),ColladaFile=function(){function e(){this.url=null,this.baseUrl=null,this.dae={},this.dae.ids={},this.dae.libEffects={},this.dae.libMaterials={},this.dae.libGeometries={},this.dae.libControllers={},this.dae.libLights={},this.dae.libImages={},this.dae.libScenes={},this.dae.libAnimations={},this.dae.asset=new ColladaAsset}return e.prototype.setUrl=function(e){var t,n;e!=null?(this.url=e,t=e.split("/"),t.pop(),this.baseUrl=((n=t.length<1)!=null?n:{".":t.join("/")})+"/"):(this.url=null,this.baseUrl=null)},e}(),ColladaAsset=function(){function e(){this.unit=1,this.upAxis="Z"}return e}(),ColladaImage=function(){function e(){this.id=null,this.init_from=null}return e}(),ColladaEffect=function(){function e(){this.id=null,this.sids={},this.technique=new ColladaEffectTechnique}return e}(),ColladaEffectTechnique=function(){function e(){this.sids={},this.parentFxScope=null,this.shading=null,this.emission=null,this.ambient=null,this.diffuse=null,this.specular=null,this.shininess=null,this.reflective=null,this.transparent=null,this.bump=null,this.reflectivity=null,this.transparency=null,this.index_of_refraction=null}return e}(),ColladaEffectSurface=function(){function e(){this.sid=null,this.type=null,this.initFrom=null}return e}(),ColladaEffectSampler=function(){function e(){this.sid=null,this.surface=null,this.image=null}return e}(),ColladaColorOrTexture=function(){function e(e){this.color=new THREE.Color(e),this.texture_sampler=null,this.texcoord=null,this.opaque=null,this.bump=null}return e}(),ColladaMaterial=function(){function e(){this.id=null,this.name=null,this.effect=null}return e}(),ColladaGeometry=function(){function e(){this.id=null,this.name=null,this.vertices={},this.triangles={},this.indices=null}return e}(),ColladaSource=function(){function e(){this.id=null,this.sourceId=null,this.count=null,this.stride=null,this.data=null,this.params={}}return e}(),ColladaInput=function(){function e(){this.semantic=null,this.source=null,this.offset=null,this.set=null}return e}(),ColladaLoader2=function(){function e(){this.log=this.logConsole,this.readyCallback=null,this.progressCallback=null,this.file=null,this.upConversion=null,this.options={centerGeometry:!1,convertUpAxis:!1,subdivideFaces:!0,upAxis:"Y"}}return e.messageTrace=0,e.messageInfo=1,e.messageWarning=2,e.messageError=3,e.messageTypes=["TRACE","INFO","WARNING","ERROR"],e.logConsole=function(t,n){console.log("ColladaLoader2 "+e.messageTypes[n]+": "+t)},e.prototype.setLog=function(e){this.log=e||this.logConsole},e.prototype.load=function(t,n,r){var i,s;this.readyCallback=n,i=0,document.implementation&&document.implementation.createDocument?(s=new XMLHttpRequest,s.overrideMimeType&&s.overrideMimeType("text/xml"),s.onreadystatechange=function(){if(s.readyState===4){if(s.status===0||s.status===200)return s.responseXML?this.parse(s.responseXML,n,t):this.log("Empty or non-existing file "+t+".",e.messageError)}else if(s.readyState===3&&r)return i===0&&(i=s.getResponseHeader("Content-Length")),r({total:i,loaded:s.responseText.length})},s.open("GET",t,!0),s.send(null)):this.log("Don't know how to parse XML!",e.messageError)},e.prototype.parse=function(e,t,n){var r;return this.readyCallback=t,this.file=new ColladaFile,this.file.setUrl(n),this._parseXml(e),r=this.file,this.file=null,this.readyCallback&&this.readyCallback(r),r},e.prototype._reportUnexpectedChild=function(t,n){return this.log("Skipped unknown <"+t+"> child <"+n+">.",e.messageWarning)},e.prototype._parseXml=function(t){var n,r,i,s,o,u,a,f;if(((o=t.childNodes[0])!=null?(u=o.nodeName)!=null?u.toUpperCase():void 0:void 0)==="COLLADA"){r=t.childNodes[0],a=r.childNodes,f=[];for(i=0,s=a.length;i<s;i++)n=a[i],n.nodeType===1&&f.push(this._parseColladaChild(n));return f}return this.log("Can not parse document, top level element is not <COLLADA>.",e.messageError)},e.prototype._getFirstChildByName=function(e,t){var n,r,i,s;s=e.childNodes;for(r=0,i=s.length;r<i;r++){n=s[r];if(n.nodeType===1&&n.nodeName===t)return n}return null},e.prototype._parseColladaChild=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m;switch(e.nodeName){case"asset":h=e.childNodes;for(n=0,o=h.length;n<o;n++)t=h[n],t.nodeType===1&&this._parseAssetChild(t);break;case"library_effects":p=e.childNodes;for(r=0,u=p.length;r<u;r++)t=p[r],t.nodeType===1&&this._parseLibEffectChild(t);break;case"library_materials":d=e.childNodes;for(i=0,a=d.length;i<a;i++)t=d[i],t.nodeType===1&&this._parseLibMaterialChild(t);break;case"library_geometries":v=e.childNodes;for(s=0,f=v.length;s<f;s++)t=v[s],t.nodeType===1&&this._parseLibGeometryChild(t);break;case"library_images":m=e.childNodes;for(c=0,l=m.length;c<l;c++)t=m[c],t.nodeType===1&&this._parseLibImageChild(t);break;default:this._reportUnexpectedChild("COLLADA",e.nodeName)}},e.prototype._parseAssetChild=function(e){var t;switch(e.nodeName){case"unit":t=e.getAttribute("meter"),t!=null&&(this.file.dae.asset.unit=parseFloat(t));break;case"up_axis":this.file.dae.asset.upAxis=e.textContent.toUpperCase().charAt(0),this.upConversion=this._getUpConversion(this.file.dae.asset.upAxis,this.options.upAxis);break;case"contributor":case"created":case"modified":break;default:this._reportUnexpectedChild("asset",e.nodeName)}},e.prototype._parseLibEffectChild=function(e){var t,n,r,i,s;switch(e.nodeName){case"effect":n=new ColladaEffect,n.id=e.getAttribute("id"),this._addUrlTarget(n,"libEffects"),s=e.childNodes;for(r=0,i=s.length;r<i;r++)t=s[r],t.nodeType===1&&this._parseEffectChild(n,t);break;default:this._reportUnexpectedChild("library_effects",e.nodeName)}},e.prototype._parseEffectChild=function(t,n){var r,i,s,o,u;switch(n.nodeName){case"profile_COMMON":o=n.childNodes,u=[];for(i=0,s=o.length;i<s;i++)r=o[i],r.nodeType===1&&u.push(this._parseEffectProfileCommonChild(t,r));return u;case"profile":return this.log("Skipped non-common effect profile for effect "+t.id+".",e.messageWarning);default:return this._reportUnexpectedChild("effect",n.nodeName)}},e.prototype._parseEffectProfileCommonChild=function(e,t){var n,r,i,s,o,u,a,f;r=t.getAttribute("sid");switch(t.nodeName){case"newparam":a=t.childNodes;for(i=0,o=a.length;i<o;i++)n=a[i],n.nodeType===1&&this._parseEffectNewparamChild(e,r,n);break;case"technique":f=t.childNodes;for(s=0,u=f.length;s<u;s++)n=f[s],n.nodeType===1&&this._parseEffectTechniqueChild(e,r,n);break;default:this._reportUnexpectedChild("profile_COMMON",t.nodeName)}},e.prototype._parseEffectNewparamChild=function(e,t,n){var r,i,s,o,u,a,f,l,c;switch(n.nodeName){case"surface":s=new ColladaEffectSurface,s.type=n.getAttribute("type"),s.sid=t,this._addFxTarget(s,e),l=n.childNodes;for(o=0,a=l.length;o<a;o++)r=l[o],r.nodeType===1&&this._parseEffectSurfaceChild(e,s,t,r);break;case"sampler2D":i=new ColladaEffectSampler,i.sid=t,this._addFxTarget(i,e),c=n.childNodes;for(u=0,f=c.length;u<f;u++)r=c[u],r.nodeType===1&&this._parseEffectSamplerChild(e,i,t,r);break;default:this._reportUnexpectedChild("newparam",n.nodeName)}},e.prototype._parseEffectSurfaceChild=function(e,t,n,r){switch(r.nodeName){case"init_from":t.initFrom=new ColladaUrlLink(r.textContent,ColladaImage);break;default:this._reportUnexpectedChild("surface",r.nodeName)}},e.prototype._parseEffectSamplerChild=function(e,t,n,r){switch(r.nodeName){case"source":t.surface=new ColladaFxLink(r.textContent,e,ColladaEffectSurface);break;case"instance_image":t.image=new ColladaUrlLink(r.getAttribute("url"),ColladaImage);break;default:this._reportUnexpectedChild("sampler*",r.nodeName)}},e.prototype._parseEffectTechniqueChild=function(e,t,n){var r,i,s,o,u,a,f;switch(n.nodeName){case"blinn":case"phong":case"lambert":case"constant":e.technique.shading=n.nodeName,a=n.childNodes;for(i=0,o=a.length;i<o;i++)r=a[i],r.nodeType===1&&this._parseTechniqueParam(e,"",r);break;case"extra":f=n.childNodes;for(s=0,u=f.length;s<u;s++)r=f[s],r.nodeType===1&&this._parseTechniqueExtraChild(e,"",r);break;default:this._reportUnexpectedChild("technique",n.nodeName)}},e.prototype._parseTechniqueParam=function(t,n,r){var i,s,o,u,a;s=r.childNodes[1];switch(r.nodeName){case"newparam":a=r.childNodes;for(o=0,u=a.length;o<u;o++)i=a[o],i.nodeType===1&&this._parseEffectNewparamChild(t,sid,i);break;case"emission":case"ambient":case"diffuse":case"specular":case"reflective":this._parseEffectColorOrTexture(t,r.nodeName,s);break;case"shininess":case"reflectivity":case"transparency":case"index_of_refraction":t[r.nodeName]=parseFloat(s.textContent);break;case"transparent":this._parseEffectColorOrTexture(t,"transparent",s),t.transparent.opaque=s.getAttribute("opaque");break;case"bump":this._parseEffectColorOrTexture(t,"bump",s),t.bump.bumptype=s.getAttribute("bumptype");break;default:this.log("Skipped unknown technique shading property "+r.nodeName+".",e.messageInfo)}},e.prototype._parseTechniqueExtraChild=function(e,t,n){var r,i,s,o;switch(n.nodeName){case"technique":t=n.getAttribute("profile"),o=n.childNodes;for(i=0,s=o.length;i<s;i++)r=o[i],r.nodeType===1&&this._parseTechniqueParam(e,t,r);break;default:this._reportUnexpectedChild("technique/extra",n.nodeName)}},e.prototype._parseEffectColorOrTexture=function(e,t,n){var r,i;r=e[t],r==null&&(r=new ColladaColorOrTexture(16777215),e[t]=r);switch(n.nodeName){case"color":return i=this._strToFloats(n.textContent),r.color.setRGB(i[0],i[1],i[2]),r.color.a=i[3];case"texture":return r.texture_sampler=new ColladaFxLink(n.getAttribute("texture"),e,ColladaEffectSampler),r.texcoord=n.getAttribute("texcoord");default:return this._reportUnexpectedChild("_color_or_texture_type",n.nodeName)}},e.prototype._parseLibMaterialChild=function(e){var t,n,r,i,s;switch(e.nodeName){case"material":n=new ColladaMaterial,n.id=e.getAttribute("id"),n.name=e.getAttribute("name"),this._addUrlTarget(n,"libMaterials"),s=e.childNodes;for(r=0,i=s.length;r<i;r++)t=s[r],t.nodeType===1&&this._parseMaterialChild(n,t);break;default:this._reportUnexpectedChild("library_materials",e.nodeName)}},e.prototype._parseMaterialChild=function(e,t){switch(t.nodeName){case"instance_effect":e.effect=new ColladaUrlLink(t.getAttribute("url"),ColladaEffect);break;default:this._reportUnexpectedChild("material",t.nodeName)}},e.prototype._parseLibGeometryChild=function(e){var t,n,r,i,s;switch(e.nodeName){case"geometry":n=new ColladaGeometry,n.id=e.getAttribute("id"),n.name=e.getAttribute("name"),this._addUrlTarget(n,"libGeometries"),s=e.childNodes;for(r=0,i=s.length;r<i;r++)t=s[r],t.nodeType===1&&this._parseGeometryChild(n,t);break;default:this._reportUnexpectedChild("library_geometries",e.nodeName)}},e.prototype._parseGeometryChild=function(e,t){var n,r,i,s;switch(t.nodeName){case"mesh":s=t.childNodes;for(r=0,i=s.length;r<i;r++)n=s[r],n.nodeType===1&&this._parseMeshChild(e,n);break;default:this._reportUnexpectedChild("library_geometries",t.nodeName)}},e.prototype._parseMeshChild=function(t,n){var r,i,s,o,u,a,f,l,c,h,p,d;switch(n.nodeName){case"source":i=n.getAttribute("id"),s=new ColladaSource,s.id=i,this._addUrlTarget(s),h=n.childNodes;for(o=0,f=h.length;o<f;o++)r=h[o],r.nodeType===1&&this._parseSourceChild(s,r);break;case"vertices":p=n.childNodes;for(u=0,l=p.length;u<l;u++)r=p[u],r.nodeType===1&&this._parseVerticesChild(t,r);break;case"triangles":d=n.childNodes;for(a=0,c=d.length;a<c;a++)r=d[a],r.nodeType===1&&this._parseTrianglesChild(t,r);break;case"polygons":case"polylist":case"lines":case"linestrips":case"trifans":case"tristrips":this.log("Geometry primitive type "+n.nodeName+" not supported.",e.messageError);break;default:this._reportUnexpectedChild("library_geometries",n.nodeName)}},e.prototype._parseSourceChild=function(e,t){var n,r,i,s;switch(t.nodeName){case"bool_array":e.sourceId=t.getAttribute("id"),e.data=this._strToBools(t.textContent);break;case"float_array":e.sourceId=t.getAttribute("id"),e.data=this._strToFloats(t.textContent);break;case"int_array":e.sourceId=t.getAttribute("id"),e.data=this._strToInts(t.textContent);break;case"IDREF_array":case"Name_array":e.sourceId=t.getAttribute("id"),e.data=this._strToStrings(t.textContent);break;case"technique_common":s=t.childNodes;for(r=0,i=s.length;r<i;r++)n=s[r],n.nodeType===1&&this._parseSourceTechniqueCommonChild(e,n);break;default:this._reportUnexpectedChild("source",t.nodeName)}},e.prototype._parseSourceTechniqueCommonChild=function(t,n){var r,i,s,o,u;switch(n.nodeName){case"accessor":i=n.getAttribute("source"),t.count=n.getAttribute("count"),t.stride=n.getAttribute("stride"),i!=="#"+t.sourceId&&this.log("Non-local sources not supported, source data will be empty",e.messageError),u=n.childNodes;for(s=0,o=u.length;s<o;s++)r=u[s],r.nodeType===1&&this._parseTechniqueAccessorChild(t,r);break;default:this._reportUnexpectedChild("library_geometries",n.nodeName)}},e.prototype._parseTechniqueAccessorChild=function(e,t){var n,r;switch(t.nodeName){case"param":n=t.getAttribute("name"),r=t.getAttribute("type"),e.params[n]=r;break;default:this._reportUnexpectedChild("accessor",t.nodeName)}},e.prototype._createInput=function(e){var t,n,r;return t=new ColladaInput,t.semantic=e.getAttribute("semantic"),t.source=new ColladaUrlLink(e.getAttribute("source")),n=e.getAttribute("offset"),n!=null&&(t.offset=parseInt(n)),r=e.getAttribute("set"),r!=null&&(t.set=parseInt(r)),t},e.prototype._parseVerticesChild=function(e,t){var n;switch(t.nodeName){case"input":n=this._createInput(t),e.vertices[n.semantic]=n;break;default:this._reportUnexpectedChild("vertices",t.nodeName)}},e.prototype._parseTrianglesChild=function(e,t){var n;switch(t.nodeName){case"input":n=this._createInput(t),e.triangles[n.semantic]=n;break;case"p":e.indices=this._strToInts(t.textContent);break;default:this._reportUnexpectedChild("vertices",t.nodeName)}},e.prototype._parseLibImageChild=function(e){var t,n,r,i,s;switch(e.nodeName){case"image":n=new ColladaImage,n.id=e.getAttribute("id"),this._addUrlTarget(n,"libImages"),s=e.childNodes;for(r=0,i=s.length;r<i;r++)t=s[r],t.nodeType===1&&this._parseImageChild(n,t);break;default:this._reportUnexpectedChild("library_images",e.nodeName)}},e.prototype._parseImageChild=function(e,t){switch(t.nodeName){case"init_from":e.init_from=t.textContent;break;default:this._reportUnexpectedChild("image",t.nodeName)}},e.prototype._getUpConversion=function(e,t){var n,r,i;if(!this.options.convertUpAxis||e===t)return null;switch(e){case"X":return(n=t==="Y")!=null?n:{XtoY:"XtoZ"};case"Y":return(r=t==="X")!=null?r:{YtoX:"YtoZ"};case"Z":return(i=t==="X")!=null?i:{ZtoX:"ZtoY"}}},e.prototype._addUrlTarget=function(t,n){var r;r=t.id;if(r==null){this.log("Object has no ID.",e.messageError);return}if(this.file.dae.ids[r]!=null){this.log("There is already an object with ID "+r+".",e.messageError);return}this.file.dae.ids[r]=t;if(n!=null)return this.file.dae[n][r]=t},e.prototype._addFxTarget=function(t,n){var r;r=t.sid;if(r==null){this.log("Object has no SID.",e.messageError);return}if(n.sids[r]!=null){this.log("There is already an FX target with SID "+r+".",e.messageError);return}return n.sids[r]=t},e.prototype._getLinkTarget=function(e){return e.object==null&&e.resolve(this.file,this.log),e.object},e.prototype._strToStrings=function(e){var t;return e.length>0?(t=e.trim(),t.split(/\s+/)):[]},e.prototype._strToFloats=function(e){var t,n,r,i,s,o;i=this._strToStrings(e),t=new Array(i.length);for(n=s=0,o=i.length;s<o;n=++s)r=i[n],t[n]=parseFloat(r);return t},e.prototype._strToInts=function(e){var t,n,r,i,s,o;i=this._strToStrings(e),t=new Array(i.length);for(n=s=0,o=i.length;s<o;n=++s)r=i[n],t[n]=parseInt(r);return t},e.prototype._strToBools=function(e){var t,n,r,i,s,o,u;i=this._strToStrings(e),t=new Array(i.length);for(n=s=0,o=i.length;s<o;n=++s)r=i[n],t[n]=(u=r==="true"||r==="1")!=null?u:{"true":!1};return t},e}();